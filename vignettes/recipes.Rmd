---
title: "Theming recipes"
author: "Carson Sievert"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Theming recipes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
library(bootstraplib)
knitr::opts_chunk$set(
  out.width = "80%",
  fig.align = "center"
)
```

> **DISCLAIMER:** This document demonstrates what's possible _today_ with **bootstraplib** theming and is still a work in progress. It should become more complete and keep improving in the coming months.

The following sections contain "recipes" for custom theming of **shiny** apps and **rmarkdown** documents via **bootstraplib**. Most the example code here is specifically for **shiny**, so you'll see repeated use of `bs_global_theme()` to start a new theme; but note that calling `bs_global_theme()` inside **rmarkdown** documents is not necessary (the `bootstrap_version` and `theme` arguments to `rmarkdown::html_document` should instead be used to choose the version and bootswatch theme). 

For the sake of novelty, some of the more specific recipes focus on theming **shiny** apps with [Bootstrap 4 Sass](https://getbootstrap.com/docs/4.4/getting-started/theming/), but many of the same ideas can also translate to [Bootstrap 3 Sass](https://github.com/twbs/bootstrap-sass). For those looking to learn more about the foundational **bootstraplib** and **sass** tools that make these recipes possible, see the [foundations article](foundations.html).

## Colors

The quickest and simplest way to provide a custom color palette to a **bootstraplib** theme is to use `bs_base_colors()` and `bs_theme_accent_colors()`. These functions are designed to work with any version of Bootstrap and control numerous color styling defaults in **shiny** apps and **rmarkdown** documents that use `bootstraplib::bs_dependencies()`. More specifically, these functions set numerous [Bootstrap Sass variable defaults](https://getbootstrap.com/docs/4.4/getting-started/theming/#variable-defaults) via `bs_theme_add_variables()` (you can always use this function to set specific Sass variable defaults, if you wish).

```r
library(bootstraplib)
bs_global_theme()
# Color palette derives from https://tombrow.com/dark-mode-website-css
bs_base_colors(bg = "#444", fg = "#e4e4e4")
bs_theme_accent_colors(primary = "#e39777", secondary = "#fdce93")
bs_theme_preview()
```

```{r, echo = FALSE}
knitr::include_graphics("https://i.imgur.com/h1jWMNq.png")
```

## Fonts

Use the `bs_theme_fonts()` function to easily set the default (i.e., `base`) font family, as well as families for `code`, `heading`s, and `input`:

```r
bs_theme_fonts(base = "Roboto Condensed", code = "Monaco")
bs_theme_preview()
```

```{r, echo = FALSE}
knitr::include_graphics("https://i.imgur.com/xGde5wZ.png")
```

As for font size, there is one main Sass variable, named `$font-size-base` (in both Bootstrap 3 and 4) that can be used to increase or decrease the base font size. For more granular control over font-sizes, consider searching through the Sass variables for `font-size` ([for example](https://github.com/rstudio/bootstraplib/blob/555f80d/inst/lib/bootstrap/scss/_variables.scss#L286-L304)) and setting variable(s) of interest.

```r
bs_theme_add_variables("font-size-base" = "1.5rem")
```


For non-standard font families, you may want to consider downloading the relevant font files and serving those font files with your application. The [**gfonts**](https://github.com/dreamRs/gfonts) package offers a nice way to `download_font()`s from Google Fonts. For example, if our working directory was a **shiny** app directory, and we want the Monserrat font, we could run:

```r
library(gfonts)
font_dir <- "www/fonts"
if (!dir.exists(font_dir)) dir.create(font_dir)
download_font("montserrat", output_dir = font_dir)
```

Then, use `bs_theme_fonts()` to let Bootstrap know to use the Monserrat font as well as `bs_theme_add()`+`generate_css()` to let the browser know where the find the font files:

```r
bs_theme_fonts(base = "Monserrat")
bs_theme_add(rules = generate_css("montserrat", font_dir = font_dir))
shiny::runApp()
```

## Plots

The new [**thematic** package](https://github.com/rstudio/thematic) enables automatic theming of **ggplot2**, **lattice**, and **base** graphics based on the relevant HTML container's styling. This means, to get plot's to automatic inherit the app's styling, simply call: `thematic::thematic_on()`. Also, our app's styling uses a Google Font, we can set `font = "auto"`, and the plot's text will reflect the font family as well. Notice how, in addition to the foreground and background color, auto-theming uses the link color (i.e. `primary`) as an `accent` color. If desired, the `accent` color may be set directly in `thematic_on()` (or, to avoid a new default entirely, set `accent = NA`). 

```r
remotes::install_github("rstudio/thematic")
library(thematic)
thematic_on(font = "auto")
shiny::onStop(thematic_off)
bs_theme_preview()
```

```{r, echo = FALSE}
knitr::include_graphics("https://i.imgur.com/A2yqCIi.png")
```

## Tables

[A future version](https://github.com/rstudio/DT/pull/740) of **DT** will gain the ability to automatically theme itself based on currently set **bootstraplib** theme, which works with `DT::dataTableOutput()` inside **shiny** as well as with `DT::datatable()` in **rmarkdown**.

```r
# remotes::install_github("rstudio/DT#740")
bs_theme_preview()
```

```{r, echo = FALSE}
knitr::include_graphics("https://i.imgur.com/51k95Hd.png")
```

For more granular control, you can set the [Bootstrap table](https://getbootstrap.com/docs/4.4/content/tables/) [Sass variables](https://github.com/rstudio/bootstraplib/blob/ba67fa9/inst/node_modules/bootstrap/scss/_variables.scss#L355-L369) more directly via `bs_theme_add_variables()` and **DT** should style itself sensibly based on these values. Alternatively, you can also override [dataTables Sass variable](https://github.com/DataTables/DataTablesSrc/blob/ce2c7c1/css/jquery.dataTables.scss#L9-L28) defaults directly using `DT::datatableThemeVariables()`. The upside of the former (i.e., `bs_theme_add_variables()`) approach is that you can theme both `DT::dataTableOutput()` as well as the more basic `shiny::dataTableOutput()` all at once. The upside of the latter approach (i.e., `DT::datatableThemeVariables()`) is that you can theme **DT** outside of **shiny** and **rmarkdown** and without depending on Bootstrap. 

## Other shiny outputs

Core **shiny** outputs like `renderPlot()`, `renderTable()`, `renderPrint()`, etc. have support for auto-theming based on the current **bootstraplib** theme. However, at least initially, other third-party outputs won't auto-theme themselves, but developers will have the opportunity to implement such behavior by adding a `shiny-report-theme` class to their output's HTML container (**htmlwidgets** can do this by setting `reportTheme = TRUE` in `shinyWidgetOutput()`) and using `shiny::getCurrentOutputInfo()` server-side to obtain relevant computed styles (as shown below).

```r
shinyApp(
  fluidPage(bs_dependencies(),
    tagAppendAttributes(
      verbatimTextOutput("info"), 
      class = "shiny-report-theme"
    )  
  ),
  function(input, output) {
    output$info <- renderPrint(str(getCurrentOutputInfo()))
  }
)
```

```{r, echo = FALSE}
knitr::include_graphics("https://i.imgur.com/CnqF7NW.png")
```


## Wells

Core **shiny** UI functions like `wellPanel()` and `sidebarPanel()` are based on the [BS3 well class](https://getbootstrap.com/docs/3.4/components/#wells). When `version = "4+3"`, this class extends the BS4 `card` class, making it feasible to style wells using some of the [card theming variables](https://github.com/rstudio/bootstraplib/blob/ba67fa9f6/inst/node_modules/bootstrap/scss/_variables.scss#L829-L850). We also introduce our own [`$well-bg` variable](https://github.com/rstudio/bootstraplib/blob/ba67fa9f6/inst/bs3compat/_declarations.scss#L27) to set the background color to get the right default styling. Here we'll set that Sass variable to a [mix](https://sass-lang.com/documentation/modules/color#mix) of 80% of the base background color and 20% of the foreground color:

```r
bs_theme_add_variables(
  "well-bg" = "mix(#444444, #e4e4e4, 80%)",
  "card-border-color" = "darken($well-bg, 5%)",
  "card-border-radius" = 0,
  "card-border-width" = "0.5rem"
)
bs_theme_preview()
```

```{r, echo = FALSE}
knitr::include_graphics("https://i.imgur.com/HGfHO4k.png")
```

## Buttons

Core **shiny** UI functions like `downloadButton()` and `actionButton()` emit HTML markup with the [BS3 `btn-default` class](https://getbootstrap.com/docs/3.4/components/#dropdowns-example), which was dropped in BS4. When `version = "4+3"`, the `btn-default` class extends the BS4 `btn-secondary` class, which is why the default button picked up on `bs_theme_accent_colors(secondary = "#fdce93")` (i.e., the yellow-ish color):

```{r, echo = FALSE}
knitr::include_graphics("https://i.imgur.com/vz5rvOl.png")
```

The other buttons contain different background colors because they contain [`btn-*` modifier classes](https://getbootstrap.com/docs/4.4/components/buttons) via a `class` argument to `actionButton()` (e.g., `actionButton(..., class = "btn-primary")`). It's worth noting that `actionButton()`, like many other core shiny UI components, doesn't actually have an explicit `class` argument, but it does route implicit arguments (i.e., `...`) to it's top-level HTML container, which is why `actionButton(..., class = "btn-primary")` add the class in the appropriate place. More generally, in other cases where `...` doesn't route to the HTML tag target of interest (i.e., for [utility classes](https://getbootstrap.com/docs/4.4/utilities/borders/)), the next best option is to add a class via `tagAppendAttributes(ui, class = 'some-class')`.


## Navigation

Both **shiny** and **rmarkdown** allow you create so called "tabset panels", which are built on top of Bootstrap's [nav](https://getbootstrap.com/docs/4.4/components/navs/) API. These tabsets come in two different flavors: tabs and pills. Below is a table showing how to create either flavor of navigation in both **shiny** and **rmarkdown**.

|       | shiny            | rmarkdown                 |
|-------|------------------|---------------------------|
| tabs  | `tabsetPanel()`  | `{.tabset}`               |
| pills |  `tabsetPanel(type='pills')`/`navlistPanel()` | `{.tabset .tabset-pills}` |

By default, tabsets don't include any padding or border(s) around its content; yet in most cases, having both greatly improves the overall look and readability. Thanks to Bootstrap 4 [utitilty classes](https://getbootstrap.com/docs/4.4/utilities/borders/), it's fairly straight-forward to add custom [padding](https://getbootstrap.com/docs/4.4/utilities/spacing/) and borders around content in both **shiny** (by adding relevant classes to `tabPanel(class = ...)`) and **rmarkdown** (by adding relevant classes to the `.tabset` sections). For example, here is a reasonable set of padding and border classes for tabs:

```r
tabPanel(..., class = "p-3 border border-top-0 rounded-bottom")
```

```{r, echo = FALSE}
knitr::include_graphics("https://i.imgur.com/ui9ZpXG.png")
```

And, for `tabsetPanel(type="pills", ...)`, fully rounded borders looks better:

```r
tabPanel(..., class = "p-3 border rounded")
```

```{r, echo = FALSE}
knitr::include_graphics("https://i.imgur.com/ygEmj0Z.png")
```


When it comes to controlling color and/or border styling of the tabs and/or pills, it can be useful to set [these Sass variable defaults](https://github.com/rstudio/bootstraplib/blob/555f80d/inst/lib/bootstrap/scss/_variables.scss#L698-L717) directly. For example, suppose we'd like to change the background color for active tabs/pills to our `secondary` accent color (instead of the default behavior of inheriting from the `primary` accent color) as well as the non-active links to our `primary` color. It's not obvious from the variables file, but the non-active link color is based on `$link-color`, which is intentional, since from an accessibility perspective, those non-active links behave very similarly to hyperlinks, and thus, should be styled consistently.

```r
bs_theme_add_variables(
  "link-color" = "#e39777",
  "nav-pills-link-active-bg" = "#fdce93",
  "nav-tabs-link-active-bg" = "#fdce93",
  "dropdown-link-active-bg" = "#fdce93"
)
bs_theme_add(
  declarations  = list("nav-tabs-link-active-color" = "color-yiq(#fdce93)")
)
bs_theme_preview()
```

```{r, echo = FALSE}
# TODO: why doesn't `$dropdown-link-hover-bg` work? bs3compat issue?
knitr::include_graphics("https://i.imgur.com/FsgpPjc.png")
```


## Other shiny inputs

In a future version of **shiny**, input widgets (e.g., `sliderInput()`, `selectizeInput()`, `dateInput()`, etc) will inherit styling from Bootstrap Sass variable values, but we will likely also provide Sass variables for more direct control over their styling.
